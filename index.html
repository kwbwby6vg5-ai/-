<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Snake Game</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #111;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-family: Arial, sans-serif;
      touch-action: none;
      min-height: 100vh;
    }
    .score-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    #score { font-size: 24px; }
    #pause-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #333;
      border: 2px solid #666;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #fff;
      transition: all 0.2s;
    }
    #game-board {
      background: #222;
      display: grid;
      gap: 1px;
      border: 2px solid #444;
      transition: all 0.3s;
      position: relative;
    }
    #game-board.tutorial {
      background-image: linear-gradient(#333 1px, transparent 1px),
                        linear-gradient(90deg, #333 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .tutorial-text {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #f44336;
      font-size: 14px;
      font-weight: bold;
      line-height: 1.4;
      text-shadow: 0 0 2px #000;
      z-index: 10;
    }
    #tips { margin-top: 10px; color: #888; text-align: center; }
    #start-btn {
      padding: 20px 50px;
      border: none;
      border-radius: 100px;
      background: #4CAF50;
      color: white;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 10px;
    }
    .lang-group {
      display: flex;
      gap: 10px;
      margin-top: 6px;
    }
    .lang-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      background: #555;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    .lang-btn.active {
      background: #4CAF50;
    }
    .modal {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 999;
    }
    .device-btn, .skip-btn {
      font-size: 22px;
      padding: 14px 28px;
      margin: 10px;
      border-radius: 12px;
      border: none;
      background: #4CAF50;
      color: white;
      cursor: pointer;
    }
    .notice {
      font-size: 14px;
      color: #FFEB3B;
      margin-top: 15px;
      max-width: 300px;
      text-align: center;
      line-height: 1.4;
    }
    .victory-text {
      font-size: 50px;
      color: #FFEB3B;
      text-shadow: 0 0 15px #FFEB3B;
      margin-bottom: 20px;
    }
    .gameover-text {
      font-size: 50px;
      color: #F44336;
      text-shadow: 0 0 15px #F44336;
      margin-bottom: 20px;
    }
    .countdown {
      font-size: 80px;
      color: #4CAF50;
      font-weight: bold;
      animation: flash 0.6s infinite alternate;
    }
    @keyframes flash {
      from { opacity: 0.4; }
      to { opacity: 1; }
    }
    .final-score { font-size: 28px; margin-bottom: 20px; }
    .restart-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 50px;
      background: #2196F3;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="score-row" style="display:none;">
  <div id="score">Score: 0</div>
  <button id="pause-btn">‚è∏</button>
</div>
<div id="game-board" style="display:none;"></div>
<div id="tips" style="display:none;">PC: ‚Üë‚Üì‚Üê‚Üí | Space=Pause | Mobile: Swipe | Tap circle to pause</div>

<button id="start-btn">Start</button>
<div class="lang-group">
  <button class="lang-btn" id="btn-en">English</button>
  <button class="lang-btn" id="btn-cn">‰∏≠Êñá</button>
</div>

<script>
  const gameBoard = document.getElementById('game-board');
  const scoreRow = document.querySelector('.score-row');
  const scoreElement = document.getElementById('score');
  const startBtn = document.getElementById('start-btn');
  const pauseBtn = document.getElementById('pause-btn');
  const tips = document.getElementById('tips');
  const btnEn = document.getElementById('btn-en');
  const btnCn = document.getElementById('btn-cn');

  const langText = {
    cn: {
      start: 'ÂºÄÂßã',
      chooseDevice: 'ÈÄâÊã©ËÆæÂ§á',
      keyboard: '‚å®Ô∏è ÈîÆÁõò',
      mobile: 'üì± ÊâãÊú∫',
      keyboardGuide: '‰ΩøÁî® ‚Üë ‚Üì ‚Üê ‚Üí ÁßªÂä®',
      mobileGuide: 'ÊªëÂä®Â±èÂπïÁßªÂä®',
      ok: 'Á°ÆÂÆö',
      goal: 'ÁõÆÊ†áÔºöÂêÉÊéâÈ£üÁâ©',
      notice: 'Ê≥®ÊÑèÔºöÁ¢∞Â¢ô/Á¢∞Ëá™Â∑±Âç≥Ê≠ª',
      tabletNotice: 'Âπ≥ÊùøÁî®Êà∑ÂèØÂú®Ê∏∏Áé©‰∏≠ÈöèÊÑèÂàáÊç¢Êìç‰ΩúÊñπÂºè',
      skipTutorial: 'ÊòØÂê¶Ë∑≥ËøáÊïôÂ≠¶ÂÖ≥Ôºü',
      tutorial: 'ÊïôÂ≠¶ÂÖ≥',
      level1: 'Á¨¨‰∏ÄÂÖ≥',
      level2: 'Á¨¨‰∫åÂÖ≥',
      gameOver: 'Ê∏∏ÊàèÁªìÊùü',
      tutorialComplete: 'ÊïôÂ≠¶ÂÆåÊàêÔºÅ',
      victory: 'ÊÅ≠ÂñúËøáÂÖ≥ÔºÅ',
      finalWin: '‰Ω†Ëµ¢‰∫ÜÔºÅ',
      perfect: 'ÂÆåÁæéÔºÅ',
      score: 'ÂàÜÊï∞',
      nextLevel: 'Âç≥Â∞ÜËøõÂÖ•‰∏ã‰∏ÄÂÖ≥',
      playAgain: 'ÈáçÊñ∞ÂºÄÂßã',
    },
    en: {
      start: 'Start',
      chooseDevice: 'Choose Device',
      keyboard: '‚å®Ô∏è Keyboard',
      mobile: 'üì± Mobile',
      keyboardGuide: 'Use ‚Üë ‚Üì ‚Üê ‚Üí to move',
      mobileGuide: 'Swipe to move',
      ok: 'OK',
      goal: 'Goal: Eat food',
      notice: 'Notice: Die if hit wall/self',
      tabletNotice: 'Tablet users can switch control mode anytime while playing',
      skipTutorial: 'Skip tutorial?',
      tutorial: 'Tutorial',
      level1: 'Level 1',
      level2: 'Level 2',
      gameOver: 'Game Over',
      tutorialComplete: 'Tutorial Complete!',
      victory: 'Victory!',
      finalWin: 'You Win!',
      perfect: 'Perfect!',
      score: 'Score',
      nextLevel: 'Next Level Soon',
      playAgain: 'Play Again',
    }
  };

  let lang = 'en';
  let mode = null;
  let level = 0;
  let gridSize = 20;
  let speed = 280;
  let score = 0;
  let snake, food, direction;
  let gameLoop;
  let isGameStarted = false;
  let isPaused = false;
  let tutorialSkipped = false;

  let touchStartX = 0;
  let touchStartY = 0;

  function t(key) {
    return langText[lang][key];
  }

  function setLang(newLang) {
    lang = newLang;
    startBtn.innerText = t('start');
    btnEn.classList.toggle('active', lang === 'en');
    btnCn.classList.toggle('active', lang === 'cn');
  }

  btnEn.onclick = () => setLang('en');
  btnCn.onclick = () => setLang('cn');

  function resetGame() {
    clearInterval(gameLoop);
    if (level === 0) {
      gridSize = 20;
      speed = 280;
      gameBoard.classList.add('tutorial');
    } else {
      gameBoard.classList.remove('tutorial');
      if (level === 1) {
        gridSize = 20;
        speed = 180;
      } else {
        gridSize = 23;
        speed = 160;
      }
    }
    gameBoard.style.gridTemplateColumns = `repeat(${gridSize}, 20px)`;
    gameBoard.style.gridTemplateRows = `repeat(${gridSize}, 20px)`;

    snake = [
      {x: Math.floor(gridSize/2), y: Math.floor(gridSize/2)},
      {x: Math.floor(gridSize/2)-1, y: Math.floor(gridSize/2)},
      {x: Math.floor(gridSize/2)-2, y: Math.floor(gridSize/2)}
    ];
    direction = {x:1, y:0};
    score = 0;
    updateScore();
    food = spawnFood();
    draw();
  }

  function updateScore() {
    let label;
    if (level === 0) label = t('tutorial');
    else if (level === 1) label = t('level1');
    else label = t('level2');
    scoreElement.innerText = `${label} | ${t('score')}: ${score}`;
  }

  function getRandomColor() {
    const colors = ['#F44336','#E91E63','#9C27B0','#673AB7','#3F51B5','#2196F3','#00BCD4','#4CAF50','#FFEB3B'];
    return colors[Math.floor(Math.random()*colors.length)];
  }

  function spawnFood() {
    let f;
    do {
      f = {x: Math.floor(Math.random()*gridSize), y: Math.floor(Math.random()*gridSize), color: getRandomColor()};
    } while (snake.some(s=>s.x===f.x&&s.y===f.y));
    return f;
  }

  function distance(a,b) {
    return Math.hypot(a.x-b.x, a.y-b.y);
  }

  function moveFoodSmart() {
    if (level !== 2 || isPaused) return;
    const head = snake[0];
    const d = distance(head, food);
    const maxStep = d < 4 ? 0.5 : d < 7 ? 1 : 1.5;
    let dx = 0, dy = 0;
    if (Math.random() > 0.5) {
      dx = (Math.random() > 0.5 ? 1 : -1) * maxStep;
    } else {
      dy = (Math.random() > 0.5 ? 1 : -1) * maxStep;
    }
    const nx = Math.round(food.x + dx);
    const ny = Math.round(food.y + dy);
    if (nx >=0 && nx < gridSize && ny >=0 && ny < gridSize && !snake.some(s=>s.x===nx&&s.y===ny)) {
      food.x = nx;
      food.y = ny;
    }
  }

  function update() {
    if (isPaused || !isGameStarted) return;
    const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
    if (head.x<0||head.x>=gridSize||head.y<0||head.y>=gridSize||snake.some((s,i)=>i>0&&s.x===head.x&&s.y===head.y)) {
      gameOver();
      return;
    }
    snake.unshift(head);
    let ate = false;
    if (head.x===food.x&&head.y===food.y) {
      score +=10;
      updateScore();
      food = spawnFood();
      ate = true;
    } else {
      snake.pop();
    }
    if (level === 0 && score >= 40) {
      tutorialComplete();
      return;
    }
    if (level === 1 && score >= 150) {
      victory();
      return;
    }
    if (level === 2 && score >= 200) {
      finalWin();
      return;
    }
    if (level === 2 && !ate) {
      setTimeout(moveFoodSmart, 300);
    }
    draw();
  }

  function draw() {
    gameBoard.innerHTML = '';
    if (level === 0) {
      const tip = document.createElement('div');
      tip.className = 'tutorial-text';
      tip.innerText = `${t('goal')}\n${t('notice')}`;
      gameBoard.appendChild(tip);
    }
    snake.forEach((s,i)=>{
      const el = document.createElement('div');
      el.style.gridColumnStart = s.x+1;
      el.style.gridRowStart = s.y+1;
      el.style.backgroundColor = i===0 ? '#4CAF50' : '#8BC34A';
      gameBoard.appendChild(el);
    });
    const f = document.createElement('div');
    f.style.gridColumnStart = food.x+1;
    f.style.gridRowStart = food.y+1;
    f.style.backgroundColor = food.color;
    f.style.border = '1px solid #fff';
    gameBoard.appendChild(f);
  }

  function gameOver() {
    clearInterval(gameLoop);
    showModal(t('gameOver'), `${t('score')}: ${score}`, false, true);
  }

  function tutorialComplete() {
    clearInterval(gameLoop);
    showModal(t('tutorialComplete'), t('nextLevel'), true, false);
  }

  function victory() {
    clearInterval(gameLoop);
    showModal(t('victory'), t('nextLevel'), true, false);
  }

  function finalWin() {
    clearInterval(gameLoop);
    showModal(t('finalWin'), t('perfect'), false, true);
  }

  function showModal(title, sub, goNext, showRestart) {
    const m = document.createElement('div');
    m.className = 'modal';
    let titleClass = title === t('gameOver') ? 'gameover-text' : 'victory-text';
    let restartHtml = showRestart ? `<button class="restart-btn">${t('playAgain')}</button>` : '';
    m.innerHTML = `
      <div class="${titleClass}">${title}</div>
      <div class="final-score">${sub}</div>
      ${restartHtml}
    `;
    document.body.appendChild(m);

    if (showRestart) {
      m.querySelector('.restart-btn').onclick = () => {
        document.body.removeChild(m);
        isPaused = false;
        pauseBtn.innerHTML = '‚è∏';
        pauseBtn.style.background = '#F44336';
        
        // Ê†∏ÂøÉÔºöÊ≠ªÂú®Á¨¨Âá†ÂÖ≥ÔºåÂ∞±ÈáçÂºÄÁ¨¨Âá†ÂÖ≥
        resetGame();
        startGameLoop();
      };
    }
    if (goNext) {
      setTimeout(()=>{
        document.body.removeChild(m);
        startCountdown();
      }, 1300);
    }
  }

  function startCountdown() {
    const m = document.createElement('div');
    m.className = 'modal';
    m.innerHTML = `<div class="countdown" id="cd">3</div>`;
    document.body.appendChild(m);
    const cd = document.getElementById('cd');
    let n = 3;
    const iv = setInterval(()=>{
      n--;
      if (n<=0) {
        clearInterval(iv);
        document.body.removeChild(m);
        level++;
        resetGame();
        startGameLoop();
      } else {
        cd.innerText = n;
      }
    }, 800);
  }

  function togglePause() {
    if (!isGameStarted) return;
    isPaused = !isPaused;
    if (isPaused) {
      pauseBtn.innerHTML = '‚ñ∂';
      pauseBtn.style.background = '#4CAF50';
    } else {
      pauseBtn.innerHTML = '‚è∏';
      pauseBtn.style.background = '#F44336';
    }
  }

  function startGameLoop() {
    clearInterval(gameLoop);
    gameLoop = setInterval(update, speed);
  }

  function askSkipTutorial() {
    const m = document.createElement('div');
    m.className = 'modal';
    m.innerHTML = `
      <div style="font-size:28px; color:#fff; margin-bottom:20px;">${t('skipTutorial')}</div>
      <button class="skip-btn" id="skip-yes">${lang === 'en' ? 'Yes' : 'ÊòØ'}</button>
      <button class="skip-btn" id="skip-no">${lang === 'en' ? 'No' : 'Âê¶'}</button>
    `;
    document.body.appendChild(m);
    m.querySelector('#skip-yes').onclick = () => {
      tutorialSkipped = true;
      document.body.removeChild(m);
      chooseDevice();
    };
    m.querySelector('#skip-no').onclick = () => {
      tutorialSkipped = false;
      document.body.removeChild(m);
      chooseDevice();
    };
  }

  function chooseDevice() {
    const m = document.createElement('div');
    m.className = 'modal';
    m.innerHTML = `
      <div style="font-size:30px; margin-bottom:10px; color:#fff;">${t('chooseDevice')}</div>
      <button class="device-btn" id="kb">${t('keyboard')}</button>
      <button class="device-btn" id="tb">${t('mobile')}</button>
      <div class="notice">${t('tabletNotice')}</div>
    `;
    document.body.appendChild(m);
    m.querySelector('#kb').onclick = () => {
      mode = 'keyboard';
      document.body.removeChild(m);
      showKeyboardGuide();
    };
    m.querySelector('#tb').onclick = () => {
      mode = 'touch';
      document.body.removeChild(m);
      showTouchGuide();
    };
  }

  function showKeyboardGuide() {
    const m = document.createElement('div');
    m.className = 'modal';
    m.innerHTML = `
      <div class="victory-text">${t('keyboard')}</div>
      <div class="final-score">${t('keyboardGuide')}</div>
      <button class="restart-btn">${t('ok')}</button>
    `;
    document.body.appendChild(m);
    m.querySelector('.restart-btn').onclick = () => {
      document.body.removeChild(m);
      startGameFlow();
    };
  }

  function showTouchGuide() {
    const m = document.createElement('div');
    m.className = 'modal';
    m.innerHTML = `
      <div class="victory-text">${t('mobile')}</div>
      <div class="final-score">${t('mobileGuide')}</div>
      <button class="restart-btn">${t('ok')}</button>
    `;
    document.body.appendChild(m);
    m.querySelector('.restart-btn').onclick = () => {
      document.body.removeChild(m);
      startGameFlow();
    };
  }

  function startGameFlow() {
    startBtn.style.display = 'none';
    document.querySelector('.lang-group').style.display = 'none';
    scoreRow.style.display = 'flex';
    gameBoard.style.display = 'grid';
    tips.style.display = 'block';

    isGameStarted = true;
    isPaused = false;
    pauseBtn.innerHTML = '‚è∏';
    pauseBtn.style.background = '#F44336';

    if (tutorialSkipped) {
      level = 1;
    } else {
      level = 0;
    }
    resetGame();
    startGameLoop();
  }

  startBtn.onclick = () => {
    askSkipTutorial();
  };

  pauseBtn.onclick = togglePause;

  document.addEventListener('keydown', e=>{
    if (e.keyCode === 32) { togglePause(); e.preventDefault(); }
    if (isPaused || !isGameStarted) return;
    const k = e.keyCode;
    const L=37,U=38,R=39,D=40;
    if (k===L && direction.x!==1) direction={x:-1,y:0};
    if (k===U && direction.y!==1) direction={x:0,y:-1};
    if (k===R && direction.x!==-1) direction={x:1,y:0};
    if (k===D && direction.y!==-1) direction={x:0,y:1};
  });

  document.addEventListener('touchstart', e=>{
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  });

  document.addEventListener('touchend', e=>{
    if (!isGameStarted || isPaused) return;
    let x = e.changedTouches[0].clientX;
    let y = e.changedTouches[0].clientY;
    let dx = x - touchStartX;
    let dy = y - touchStartY;
    if (Math.abs(dx) > Math.abs(dy)) {
      if (dx > 20 && direction.x !== -1) direction = {x:1,y:0};
      if (dx < -20 && direction.x !== 1) direction = {x:-1,y:0};
    } else {
      if (dy > 20 && direction.y !== -1) direction = {x:0,y:1};
      if (dy < -20 && direction.y !== 1) direction = {x:0,y:-1};
    }
  });
</script>
</body>
</html>
